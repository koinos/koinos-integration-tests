networks:
  p2p:
    name: p2p
  producer:
    name: producer
  brigade1:
    name: brigade1
  brigade2:
    name: brigade2

services:
  #producer
  amqp-prod:
    image: rabbitmq:alpine
    ports:
      - "5672:5672"
    networks:
      - producer

  jsonrpc-prod:
    image: koinos/koinos-jsonrpc:${JSONRPC_TAG}
    networks:
      - producer
    ports:
      - "8080:8080"
    command: -a amqp://guest:guest@amqp-prod:5672/ -l /ip4/0.0.0.0/tcp/8888

  mempool-prod:
    image: koinos/koinos-mempool:${MEMPOOL_TAG}
    networks:
      - producer
    command: -a amqp://guest:guest@amqp-prod:5672/

  block-store-prod:
    image: koinos/koinos-block-store:${BLOCK_STORE_TAG}
    networks:
      - producer
    command: -a amqp://guest:guest@amqp-prod:5672/

  chain-prod:
    image: koinos/koinos-chain:${CHAIN_TAG}
    networks:
      - producer
    command: -a amqp://guest:guest@amqp-prod:5672/

  p2p-prod:
    image: koinos/koinos-p2p:${P2P_TAG}
    networks:
      - producer
      - p2p
    command: -a amqp://guest:guest@amqp-prod:5672/ -s bucket_brigade_producer

  block-producer-prod:
    networks:
      - producer
    image: koinos/koinos-block-producer:${BLOCK_PRODUCER_TAG}
    command: -a amqp://guest:guest@amqp-prod:5672/

  #brigade1
  amqp-brig1:
    image: rabbitmq:alpine
    networks:
      - brigade1

  jsonrpc-brig1:
    image: koinos/koinos-jsonrpc:${JSONRPC_TAG}
    networks:
      - brigade1
    ports:
      - "8081:8080"
    command: -a amqp://guest:guest@amqp-brig1:5672/

  mempool-brig1:
    image: koinos/koinos-mempool:${MEMPOOL_TAG}
    networks:
      - brigade1
    command: -a amqp://guest:guest@amqp-brig1:5672/

  block-store-brig1:
    image: koinos/koinos-block-store:${BLOCK_STORE_TAG}
    networks:
      - brigade1
    command: -a amqp://guest:guest@amqp-brig1:5672/

  chain-brig1:
    image: koinos/koinos-chain:${CHAIN_TAG}
    networks:
      - brigade1
    command: -a amqp://guest:guest@amqp-brig1:5672/

  p2p-brig1:
    image: koinos/koinos-p2p:${P2P_TAG}
    networks:
      - brigade1
      - p2p
    command: -a amqp://guest:guest@amqp-brig1:5672/ -s bucket_brigade1 -l /ip4/0.0.0.0/tcp/8888 -p /dnsaddr/p2p-prod/tcp/8888/p2p/QmW7atAnmGJosd81c2u9ifnY45Yyy9owczaENQtaGeyoW8

  #brigade2
  amqp-brig2:
    image: rabbitmq:alpine
    networks:
      - brigade2

  jsonrpc-brig2:
    image: koinos/koinos-jsonrpc:${JSONRPC_TAG}
    networks:
      - brigade2
    ports:
      - "8082:8080"
    command: -a amqp://guest:guest@amqp-brig2:5672/

  mempool-brig2:
    image: koinos/koinos-mempool:${MEMPOOL_TAG}
    networks:
      - brigade2
    command: -a amqp://guest:guest@amqp-brig2:5672/

  block-store-brig2:
    image: koinos/koinos-block-store:${BLOCK_STORE_TAG}
    networks:
      - brigade2
    command: -a amqp://guest:guest@amqp-brig2:5672/

  chain-brig2:
    image: koinos/koinos-chain:${CHAIN_TAG}
    networks:
      - brigade2
    command: -a amqp://guest:guest@amqp-brig2:5672/

  p2p-brig2:
    image: koinos/koinos-p2p:${P2P_TAG}
    networks:
      - brigade2
      - p2p
    command: -a amqp://guest:guest@amqp-brig2:5672/ -s bucket_brigade2 -l /ip4/0.0.0.0/tcp/8888 -p /dnsaddr/p2p-brig1/tcp/8888/p2p/QmXy4o4ejSjsMKzzrDpLMLjX9SkCuVBDi2vVKtT9VMZK7Q
